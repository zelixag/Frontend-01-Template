## HTML parse

写代码习惯，先写接口，运行起来，再写代码里面规则，和业务

### 第一步总结
- 为了方便文件管理，把规则代码单独拆到文件中
- （api设计）parse接受HTML文件作为参数，返回一颗DOM树

### 第二部---创建状态
- 状态是怎么样的
- html web标准是怎么样的 (whatWg.org 12.2.5章节)

js：产生式定义词法
html比较特别：直接把状态机写出来并在章节里面写好类似源码的伪代码。其实就可以把伪代码编写成js代码
标准里面一共有80个状态 转义字符串，注释 doctype这些都不用

我们开发使用十几个状态就很好了（不超过20个）

可以用express服务搭建
下面使我们要解析的代码
```html
<html maaa=a >
<head>
    <style>
body div #myid{
    width:100px;
    background-color: #ff5000;
}
body div img{
    width:30px;
    background-color: #ff1111;
}
    </style>
</head>
<body>
    <div>
        <img id="myid"/>
        <img />
    </div>
</body>
</html>
```
初始状态为data

注意： EOF是End Of File

文本节点的结束，可能是在文件结束的时候结束。如果没有EOF之前，解析器还在等待字符，
最后就不能把文本挂上去，因为解析还没有停止的原因
提醒解析器结束

使用状态机 和特殊结束字段 解决一些类似文件结束的场景

**总结：** 
  - 我们用FSM来实现HTML的分析
  - 在HTML标准中，已经规定了HTML的状态（标准已经提供状态名）
  - Toy-Browser只挑选其中一部分状态，完成一个最简版本（目的是熟悉原理，里程碑解析html）

### 第三步解析标签
  老师有个状态图

  目前没有人传 ”\u0000“、
  有三种标签 开始标签， 结束标签 自闭和标签
  **开始标签**
    - "<" 并且下一个字符是“a-zA-Z”就是开始标签，有空格或者“>” 代表开始标签结束

   **结束标签**
    - "<"并且下一个字符是“/”就是结束标签， 有“>”代表结束标签结束
   
   **自闭和标签**
    - “《”并且下一个字符是a-zA-Z ,前面暂且判断他是开始标签，如果在后面遇上/且下一个字符是“>” 则为自闭和标签 ，设置isCloseTag 为true


  建立标签，获取标签名

### 第四步获取标签属性
    1. 属性名为标签面若干个空格之后的字母开始是属性的名称，进入获取标签名的状态机。
    2. 等号之后获取属性值，有双引号， 单引号，不包含包含属性值。进入单引号 双引号 不包含状态机进入获取属性值的获取

### 第五部将属性放入对应标签中
    当解析属性 遇到“>” 和 “ ”空格 或者 “/” 属性获取结束 将属性当如当前标签中
### 第六部使用栈生成dom树
入栈， 开始标签
遇见闭合标签结束出栈

总结： 老师的这个处理需求的过程值得学习
  - 先做知识储备，学习状态机的原理。状态机核心是处理完当前状态机需要流向下一个状态机.
    - 基础状态机结构

    ```js
    // 开始状态机
    function start(c) {
      ...
    }
    // 中间状态机
    ...
    // 结束状态机
    function end(c) {
      return end
    }
    match(string) {
      let state = start;
      for(let c of str) {
        state = state(c)
      }
      return state === end
    }
    
    ```
    - 通过简单例子见证自己对状态机设计思想验证自己对状态机的理解， 字符串匹配。（匹配字符串里面是否有ab）
    - 稍微复杂字符串匹配 abababx
    - 进阶挑战，使用状态机完成 KMP，进行字符串匹配。状态机生成，使用闭包，了解KMP算法。
  - 再熟悉业务需求，大概解决流程是什么，使用状态机完成字符串匹配的状态机流转
  - 拆分需求
    - 创建业务状态机
      - 使用whatwg12.5状态完成第一步标签状态创建
    - 元素对象的获取
      - 分析： 有三种标签开始标签，自闭和标签，结束标签
      - 根据创建的状态完成元素对象的拼接
    - 元素属性的获取
      - 分析： 处理双引号 单引号 直接属性值填写的相关重要状态
      - 根据需求在创建的状态机里面完成业务处理
    - DOM树
      - 实际场景分析，使用栈数据结构完成 DOM树的拼接，
      - 开始标签和自闭和标签对象入栈，结束标签出栈
  
